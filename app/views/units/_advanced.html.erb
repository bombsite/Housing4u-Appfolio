<div class="panel-group" id="accordion">
  <div class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">
        <div class="row">
          <div class="col-md-4 results">
            <h4>Search</h4>
          </div>
          <div class="col-md-4 col-md-offset-4" style="text-align:right;padding-right:16px;">

            <% if not request.fullpath.include? "map_view" %>

                <a href="<%=
                    if request.fullpath.include? "?"
                      request.original_url + "&map_view=1"
                    else
                      request.original_url + "?map_view=1"
                    end

                %>"><button class="btn btn-primary">Map View</button></a>

          <% else %>
                <a href="<%= request.original_url.sub! 'map_view=1', '' %>"><button class="btn btn-primary">List View</button></a>

          <% end %>
          </div>
        </div>
      </div>
    </div>
    <div class="panel-collapse collapse in" id="collapseOne">
      <div class="panel-body">
        <div class="well">
          <form id="advanced_form" action="/" method="get" role="form">
            <% if params[:map_view] %>
                <input type="hidden" name="map_view" value="1" />
            <% end %>
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label for="unit-info">Keyword</label>
                  <input id="unit-ad-content" class="form-control" placeholder="Search Description" name="search[ad_content]" value="<%= params[:search][:ad_content] %>" />
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-inline">
                  <label for="unit-info">Price range</label><br />
                  <input id="unit-ad-content" class="form-control" placeholder="Rent min" name="search[rent_min]" value="<%= params[:search][:rent_min] %>" />
                  <input id="unit-ad-content" class="form-control" placeholder="Rent max" name="search[rent_max]" value="<%= params[:search][:rent_max] %>" />
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <label for="unit-info">State</label>
                <%= select_tag "search[state_id]", options_from_collection_for_select(State.order(:name), :id, :name, params[:search][:state_id]), class: "form-control", :prompt => 'Select State' %>
              </div>
              <% unless params[:search][:state_id].nil? %>
                <div class="col-md-6">
                  <label for="unit-info">City</label>
                  <%=
                      options = City.where(state_id: params[:search][:state_id]).order(:name)
                      select_tag "search[city_id]", options_from_collection_for_select(options, :id, :name, params[:search][:city_id]), class: "form-control", :prompt => "Select City"
                  %>
                </div>
              <% end %>
            </div>
            <br />
            <% if params[:map_view] %>
                <input type="hidden" name="map_view" value="1" />
           <% end %>
            <button class="btn btn-danger" type="submit">Submit</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script type='text/javascript'>
  $(document).ready(function() {
    $("select").select2();
    $("#search_state_id").change(function() {
       $("#advanced_form").submit();
    });
  });
</script>